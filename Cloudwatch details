#!/bin/bash

# Output folder
OUTPUT_DIR="/home/ec2-user/cloudwatch_export"
mkdir -p $OUTPUT_DIR

echo "ðŸ“¥ Fetching CloudWatch Metrics..."
aws cloudwatch list-metrics --output text \
| awk 'BEGIN{OFS=","; print "Namespace,MetricName,Dimensions"} \
     {dims=""; for(i=3;i<=NF;i++) dims=dims $i ";"; print $1,$2,dims}' \
> $OUTPUT_DIR/cloudwatch_metrics.csv


echo "ðŸ“¥ Fetching CloudWatch Alarms..."
aws cloudwatch describe-alarms --output text \
| awk 'BEGIN{OFS=","; print "AlarmName,State,MetricName,Namespace,Threshold,Actions"} \
     /^ALARMS/ {print $2,$4,$11,$10,$17,$22}' \
> $OUTPUT_DIR/cloudwatch_alarms.csv


echo "ðŸ“¥ Fetching CloudWatch Log Groups..."
aws logs describe-log-groups --output text \
| awk 'BEGIN{OFS=","; print "LogGroupName,RetentionDays,StoredBytes,ARN"} \
     /^LOGGROUPS/ {print $2,$3,$4,$5}' \
> $OUTPUT_DIR/cloudwatch_loggroups.csv


echo "âœ… Export complete!"
echo "Files saved in: $OUTPUT_DIR"
ls -lh $OUTPUT_DIR


--------------
#!/bin/bash

# Output folder
OUTPUT_DIR="/home/ec2-user/cloudwatch_export"
mkdir -p $OUTPUT_DIR

OUTPUT_FILE="$OUTPUT_DIR/cloudwatch_alarms.csv"

echo "ðŸ“¥ Fetching CloudWatch Alarms..."

# Write CSV header
echo "AlarmName,StateValue,StateUpdatedTimestamp,AlarmType,MetricName,Namespace,Threshold,ComparisonOperator,EvaluationPeriods,Condition" > $OUTPUT_FILE

# Use AWS CLI JSON output and parse with awk-friendly text
aws cloudwatch describe-alarms --output text > /tmp/alarms.txt

awk '
BEGIN {FS="\t"}
$1=="ALARMS" {
    AlarmName=$2
    StateValue=$4
    UpdatedTime=$7
    MetricName=$11
    Namespace=$10
    Threshold=$17
    Comparison=$16
    Eval=$15
    Condition="Threshold=" Threshold " " Comparison " for " Eval " periods"
    print AlarmName "," StateValue "," UpdatedTime ",MetricAlarm," MetricName "," Namespace "," Threshold "," Comparison "," Eval "," Condition
}' /tmp/alarms.txt >> $OUTPUT_FILE

echo "âœ… Alarms exported to: $OUTPUT_FILE"


-------
#!/bin/bash

OUTPUT_DIR="/home/ec2-user/cloudwatch_export"
mkdir -p $OUTPUT_DIR

OUTPUT_FILE="$OUTPUT_DIR/cloudwatch_alarms.csv"

echo "ðŸ“¥ Fetching CloudWatch Alarms..."

# Write CSV header
echo "AlarmName,StateValue,StateUpdatedTimestamp,MetricName,Namespace,Threshold,ComparisonOperator,EvaluationPeriods" > $OUTPUT_FILE

# Use AWS CLI query to extract only required fields
aws cloudwatch describe-alarms \
  --query "MetricAlarms[*].[AlarmName,StateValue,StateUpdatedTimestamp,MetricName,Namespace,Threshold,ComparisonOperator,EvaluationPeriods]" \
  --output text | \
awk 'BEGIN{OFS=","} {print $1,$2,$3,$4,$5,$6,$7,$8}' >> $OUTPUT_FILE

echo "âœ… Alarms exported to: $OUTPUT_FILE"
